



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://learn2learn.net/tutorials/task_transform_tutorial/transform_tutorial/">
      
      
        <meta name="author" content="SÃ©b Arnold">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/img/favicons/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-4.6.3">
    
    
      
        <title>Demystifying Task-Transforms - learn2learn</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
    
      <link rel="stylesheet" href="../../../assets/css/l2l_material.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-68693545-3", "seba-1511.github.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#demystifying-task-transforms" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://learn2learn.net/" title="learn2learn" aria-label="learn2learn" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../../assets/img/learn2learn_white.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              learn2learn
            </span>
            <span class="md-header-nav__topic">
              
                Demystifying Task-Transforms
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/learnables/learn2learn/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    learnables/learn2learn
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://learn2learn.net/" title="learn2learn" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../../assets/img/learn2learn_white.png" width="48" height="48">
      
    </a>
    learn2learn
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/learnables/learn2learn/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    learnables/learn2learn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../anil_tutorial/ANIL_tutorial/" title="Feature Reuse with ANIL" class="md-nav__link">
      Feature Reuse with ANIL
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Demystifying Task-Transforms
      </label>
    
    <a href="./" title="Demystifying Task-Transforms" class="md-nav__link md-nav__link--active">
      Demystifying Task-Transforms
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation-for-generating-tasks" class="md-nav__link">
    Motivation for generating tasks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-task" class="md-nav__link">
    What is a task?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-used-in-context-of-meta-learning" class="md-nav__link">
    How is a task used in context of meta-learning?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-generated" class="md-nav__link">
    How is a task generated?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-of-pipeline-for-generating-tasks" class="md-nav__link">
    Overview of pipeline for generating tasks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadataset-a-wrapper-for-fast-indexing-of-samples" class="md-nav__link">
    MetaDataset - A wrapper for fast indexing of samples.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bookkeeping" class="md-nav__link">
    Bookkeeping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unionmetadataset-a-wrapper-for-multiple-datasets" class="md-nav__link">
    UnionMetaDataset - A wrapper for multiple datasets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filteredmetadataset-filter-out-unwanted-labels" class="md-nav__link">
    FilteredMetaDataset - Filter out unwanted labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#taskdataset-core-module" class="md-nav__link">
    TaskDataset - Core module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-task-description" class="md-nav__link">
    What is a task description?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-generated_1" class="md-nav__link">
    How is a task generated?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-few-general-tips" class="md-nav__link">
    A few general tips
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-tranforms-modifying-the-input-dataset" class="md-nav__link">
    Task Tranforms - Modifying the input dataset
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-interface" class="md-nav__link">
    High-Level Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-fusednwayskshots" class="md-nav__link">
    A) FusedNWaysKShots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-nways" class="md-nav__link">
    B) NWays
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-kshots" class="md-nav__link">
    C) KShots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-loaddata" class="md-nav__link">
    D) LoadData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-filterlabels" class="md-nav__link">
    E) FilterLabels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-consecutivelabels" class="md-nav__link">
    F) ConsecutiveLabels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#g-remaplabels" class="md-nav__link">
    G) RemapLabels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn/" title="learn2learn" class="md-nav__link">
      learn2learn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.data/" title="learn2learn.data" class="md-nav__link">
      learn2learn.data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.algorithms/" title="learn2learn.algorithms" class="md-nav__link">
      learn2learn.algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.optim/" title="learn2learn.optim" class="md-nav__link">
      learn2learn.optim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.nn/" title="learn2learn.nn" class="md-nav__link">
      learn2learn.nn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.vision/" title="learn2learn.vision" class="md-nav__link">
      learn2learn.vision
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../docs/learn2learn.gym/" title="learn2learn.gym" class="md-nav__link">
      learn2learn.gym
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/vision/" title="Computer Vision" class="md-nav__link">
      Computer Vision
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/rl/" title="Reinforcement Learning" class="md-nav__link">
      Reinforcement Learning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/optim/" title="Optimization" class="md-nav__link">
      Optimization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/learnables/learn2learn/" title="GitHub" class="md-nav__link">
      GitHub
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation-for-generating-tasks" class="md-nav__link">
    Motivation for generating tasks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-task" class="md-nav__link">
    What is a task?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-used-in-context-of-meta-learning" class="md-nav__link">
    How is a task used in context of meta-learning?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-generated" class="md-nav__link">
    How is a task generated?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-of-pipeline-for-generating-tasks" class="md-nav__link">
    Overview of pipeline for generating tasks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadataset-a-wrapper-for-fast-indexing-of-samples" class="md-nav__link">
    MetaDataset - A wrapper for fast indexing of samples.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bookkeeping" class="md-nav__link">
    Bookkeeping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unionmetadataset-a-wrapper-for-multiple-datasets" class="md-nav__link">
    UnionMetaDataset - A wrapper for multiple datasets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filteredmetadataset-filter-out-unwanted-labels" class="md-nav__link">
    FilteredMetaDataset - Filter out unwanted labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#taskdataset-core-module" class="md-nav__link">
    TaskDataset - Core module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-task-description" class="md-nav__link">
    What is a task description?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-is-a-task-generated_1" class="md-nav__link">
    How is a task generated?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-few-general-tips" class="md-nav__link">
    A few general tips
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-tranforms-modifying-the-input-dataset" class="md-nav__link">
    Task Tranforms - Modifying the input dataset
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-interface" class="md-nav__link">
    High-Level Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-fusednwayskshots" class="md-nav__link">
    A) FusedNWaysKShots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-nways" class="md-nav__link">
    B) NWays
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-kshots" class="md-nav__link">
    C) KShots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-loaddata" class="md-nav__link">
    D) LoadData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-filterlabels" class="md-nav__link">
    E) FilterLabels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-consecutivelabels" class="md-nav__link">
    F) ConsecutiveLabels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#g-remaplabels" class="md-nav__link">
    G) RemapLabels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/learnables/learn2learn/edit/master/docs/tutorials/task_transform_tutorial/transform_tutorial.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="demystifying-task-transforms">Demystifying Task-Transforms<a class="headerlink" href="#demystifying-task-transforms" title="Permanent link">&para;</a></h1>
<p>Written by <a href="https://nightlessbaron.github.io/">Varad Pimpalkhute</a> on 02/18/2022.</p>
<p>Notebook of this tutorial is available on <a href="https://colab.research.google.com/drive/1x7Hf59ulOFXZkkaw_oXXSFHU5hqLp_jL?usp=sharing">Colab Notebook</a>.</p>
<p>In this tutorial, we will explore in depth one of the core utilities <a href="https://github.com/learnables/learn2learn">learn2learn</a> library provides - Task Generators. </p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<ul>
<li>We will first discuss the motivation behind generating tasks. <em>(Those familiar with meta-learning can skip this section.)</em></li>
<li>Next, we will have a high-level overview of the overall pipeline used for generating tasks using <code>learn2learn</code>.</li>
<li><code>MetaDataset</code> is used fast indexing, and accelerates the process of generating few-shot learning tasks. <code>UnionMetaDataset</code> and <code>FilteredMetaDataset</code> are extensions of <code>MetaDataset</code> that can further provide customised utility. <code>UnionMetaDataset</code> builds up on <code>MetaDataset</code> to construct a union of multiple input datasets, and <code>FilteredMetaDataset</code> takes in a <code>MetaDataset</code> and filters it to include only the required labels.</li>
<li><code>TaskDataset</code> is the core module that generates tasks from input dataset. Tasks are lazily sampled upon indexing or calling <code>.sample()</code> method.</li>
<li>Lastly, we study different <code>task transforms</code> defined in <code>learn2learn</code> that modifies the input data such that a customised <code>task</code> is generated. </li>
</ul>
<h2 id="motivation-for-generating-tasks">Motivation for generating tasks<a class="headerlink" href="#motivation-for-generating-tasks" title="Permanent link">&para;</a></h2>
<h4 id="what-is-a-task">What is a task?<a class="headerlink" href="#what-is-a-task" title="Permanent link">&para;</a></h4>
<p>Let's first start with understanding what is a task. The definition of a task varies from one application to other, but in context of few-shot learning, a task is a <em>supervised-learning</em> approach (e.g., classification, regression) trained over a collection of <em>datapoints</em> (images, in context of vision) that are sampled from the same distribution.</p>
<blockquote>
<p><em>For example</em>, a task may consist of 5 images from 5 different classes - flower, cup, bird, fruit, clock (say, 1 image per class),  all sampled from the same distribution. Now, the objective of the task might be to classify the images present at test time amongst the five classes - that is, minimize over the loss function.</p>
</blockquote>
<p style="text-align:center;">
<img src="../few-shot.png" style="width:600; vertical-align: middle;"/>
    <div class="caption">
    Few-Shot Classification Tasks. Image source: <a href="https://meta-learning.fastforwardlabs.com/">Cloudera Fast Forward Report on Meta-Learning</a>.
    </div>
</p>

<hr />
<h4 id="how-is-a-task-used-in-context-of-meta-learning">How is a task used in context of meta-learning?<a class="headerlink" href="#how-is-a-task-used-in-context-of-meta-learning" title="Permanent link">&para;</a></h4>
<p>Meta-learning used in the context of few-shot learning paradigm trains over different tasks (each task consists of limited number of samples) over multiple iterations of training. For example, gradient-based meta-learners learn a model initialization prior such that the model converges to the global minima on unseen tasks (tasks that were not encountered during training) using few samples/datapoints. </p>
<hr />
<h4 id="how-is-a-task-generated">How is a task generated?<a class="headerlink" href="#how-is-a-task-generated" title="Permanent link">&para;</a></h4>
<p>In layman's terms, few-shot classification experiment is set up as a N-wayed K-shot problem. Meaning, the model needs to learn how to classify an input task over N different classes given K examples per class during training. Thus, we need to generate 'M' such tasks for training, and inferencing the meta-learner.</p>
<p><strong>Summarizing</strong>, we require to:</p>
<ol>
<li>Iterate over classes and their respective samples present in the dataset rapidly in order to generate a task.</li>
<li>Write a protocol that generates a task that adhers to the few-shot paradigm <em>(that is, <code>N-way K-shot</code> problem)</em>.</li>
<li>Incorporate additional transforms <em>(say, augmentation of data)</em>.</li>
<li>Generate <code>M</code> randomly sampled tasks for training and inferencing.</li>
</ol>
<p>Given any input dataset, <code>learn2learn</code> makes it easy for generating custom tasks depending on the user's usecase.</p>
<hr />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Import modules that would be used later.</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">learn2learn</span> <span class="k">as</span> <span class="nn">l2l</span>
<span class="kn">import</span> <span class="nn">torchvision</span> <span class="k">as</span> <span class="nn">tv</span>
<span class="kn">from</span> <span class="nn">PIL.Image</span> <span class="kn">import</span> <span class="n">LANCZOS</span>
<span class="kn">from</span> <span class="nn">learn2learn.data.transforms</span> <span class="kn">import</span> <span class="n">NWays</span><span class="p">,</span> <span class="n">KShots</span><span class="p">,</span> <span class="n">LoadData</span><span class="p">,</span> <span class="n">RemapLabels</span><span class="p">,</span> <span class="n">ConsecutiveLabels</span>
<span class="kn">from</span> <span class="nn">learn2learn.vision.transforms</span> <span class="kn">import</span> <span class="n">RandomClassRotation</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</code></pre></div>
</td></tr></table>
<h2 id="overview-of-pipeline-for-generating-tasks">Overview of pipeline for generating tasks<a class="headerlink" href="#overview-of-pipeline-for-generating-tasks" title="Permanent link">&para;</a></h2>
<p>Given any input dataset, <code>learn2learn</code> makes it easy for generating custom tasks depending on the user's usecase. A high-level overall pipeline is shown in the diagram below:</p>
<p>The dataset consists of 100 different classes, having 5 samples per class. The objective is to generate N-wayed K-shot task (say, 3-way 2-shot task from the given dataset.)</p>
<p style="text-align:center;">
<img src="../l2l-task-transform.png" style="width:600; vertical-align: middle;"/>
    <div class="caption">
    Pipeline for generating tasks in learn2learn.
    </div>
</p>

<p>The below code snippet shows to generate customised tasks using any input custom using <code>learn2learn</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># 1. Apply transforms on input data if any (eg., Resizing, converting arrays to tensors)</span>
<span class="n">data_transform</span> <span class="o">=</span> <span class="n">tv</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">tv</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">LANCZOS</span><span class="p">),</span> <span class="n">tv</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()])</span> 

<span class="c1"># 2. Download the dataset, and apply the above transforms on each of the samples</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FullOmniglot</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;~\data&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Load your custom dataset</span>

<span class="c1"># 3. Wrap the dataset using MetaDataset to enable fast indexing</span>
<span class="n">omniglot</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetaDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="c1"># Use MetaDataset to do fast indexing of samples</span>

<span class="c1"># 4. Specify transforms to be used for generating tasks</span>
<span class="n">transforms</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">NWays</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="c1"># Samples N random classes per task (here, N = 5)</span>
                    <span class="n">KShots</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># Samples K samples per class from the above N classes (here, K = 1) </span>
                    <span class="n">LoadData</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span> <span class="c1"># Loads a sample from the dataset</span>
                    <span class="n">RemapLabels</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span> <span class="c1"># Remaps labels starting from zero</span>
                    <span class="n">ConsecutiveLabels</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span> <span class="c1"># Re-orders samples s.t. they are sorted in consecutive order </span>
                    <span class="n">RandomClassRotation</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">])</span> <span class="c1"># Randomly rotate sample over x degrees (only for vision tasks)</span>
                    <span class="p">]</span>

<span class="c1"># 5. Generate set of tasks using the dataset, and transforms</span>
<span class="n">taskset</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TaskDataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">omniglot</span><span class="p">,</span> <span class="n">task_transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span> <span class="n">num_tasks</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Creates sets of tasks from the dataset </span>

<span class="c1"># Now sample a task from the taskset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">taskset</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="c1"># or, you can also sample this way:</span>
<span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">taskset</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">task</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): torch.Size([5, 1, 28, 28])</p>
</blockquote>
<p>And that's it! You have now generated one task randomly sampled from the omniglot dataset distribution. For generating <code>M</code> tasks, you will need to sample the taskset <code>M</code> times.</p>
<p>For the rest of the tutorial, we will inspect each of the modules present in the above code, and discuss a few general strategies that can be used while generating tasks efficiently.</p>
<h2 id="metadataset-a-wrapper-for-fast-indexing-of-samples">MetaDataset - A wrapper for fast indexing of samples.<a class="headerlink" href="#metadataset-a-wrapper-for-fast-indexing-of-samples" title="Permanent link">&para;</a></h2>
<p>At a high level, <code>MetaDataset</code> is a wrapper that enables fast indexing of samples of a given class in a dataset. The motivation behind building is to decrease the <script type="math/tex">\mathcal{O}(n)</script> time to <script type="math/tex">\mathcal{O}(1)</script> everytime we iterate over a dataset to generate tasks. Naturally, the time saved increases as the dataset size keeps on increasing. </p>
<blockquote>
<p><strong>Note</strong> : The input dataset needs to be iterable.</p>
</blockquote>
<p><code>learn2learn</code> does this by maintaining two dictionaries for each classification dataset:
1. <code>labels_to_indices</code>: A dictionary that maintains labels of classes as keys, and the corresponding indices of samples within the class in form of list as values.
2. <code>indices_to_labels</code>: As the name suggests, a dictionary is formed with indices of samples as key, and their corresponding class labels as value.</p>
<p>This feature comes in handy while generating tasks. For example, if you are sampling a task having <code>N</code> classes <em>(say, N=5)</em>, then using <code>labels_to_indices</code> dictionary to identify all the samples belonging to this set of 5 classes <em>(<script type="math/tex">\mathcal{O}(c)</script>)</em> will be much more faster than iterating all the samples <em>(<script type="math/tex">\mathcal{O}(n)</script>)</em>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">labels_to_indices</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1"># each label will store list of sample indices</span>
<span class="n">indices_to_labels</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># each index will store corresponding sample&#39;s label</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)):</span> <span class="c1"># iterate over all samples</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># load label</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="c1"># if label is a Tensor, then take get the scalar value</span>

    <span class="n">labels_to_indices</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># append sample&#39;s index to the given class</span>
    <span class="n">indices_to_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span> <span class="c1"># assign label to the given index</span>
</code></pre></div>
</td></tr></table>
<hr />
<blockquote>
<p>Any one of the two dictionaries can also be optionally passed as an argument upon instantiation, and the other dictionary is built using this dictionary  (See Line <a href="https://github.com/learnables/learn2learn/blob/master/learn2learn/data/meta_dataset.pyx#L81">81</a> - Line <a href="https://github.com/learnables/learn2learn/blob/master/learn2learn/data/meta_dataset.pyx#L90">90</a> on GitHub.)</p>
</blockquote>
<hr />
<h4 id="bookkeeping">Bookkeeping<a class="headerlink" href="#bookkeeping" title="Permanent link">&para;</a></h4>
<p><code>learn2learn</code> also provides another utility in the form of an attribute <code>_bookkeeping_path</code>. If the input dataset has the given attribute, then the built attributes <em>(namely, the two dictionaries, and list of labels)</em> will be cached on disk for latter use. It is recommended to use this utility if:</p>
<ol>
<li>If the dataset size is large, as it can take hours for instantiating it the first time.</li>
<li>If you are going to use the dataset again for training. <em>(Iterating over all the samples will be much slower than loading it from disk)</em></li>
</ol>
<p>To use the bookkeeping utility, while loading your custom dataset, you will need to add an additional attribute to it. </p>
<p><em>For example, we add <code>_bookkeeping_path</code> attribute while generating <a href="https://github.com/learnables/learn2learn/blob/master/learn2learn/vision/datasets/fc100.py">FC100</a> dataset as follows:</em> </p>
<p><code>self._bookkeeping_path = os.path.join(self.root, 'fc100-bookkeeping-' + mode + '.pkl')</code></p>
<p>where, mode is either <em>train, validation,</em> or <em>test</em> (depends on how you are defining your dataset. It's also possible that you are loading the entire dataset, and then creating train-valid-test splits. In that case, you can remove the mode variable)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># The variables can be loaded from the saved .pkl file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;~\data/omniglot-bookkeeping.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">_bookkeeping</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># In _bookkeeping, the three attributes are saved in the form of a dictionary</span>
<span class="n">labels_to_indices</span> <span class="o">=</span> <span class="n">_bookkeeping</span><span class="p">[</span><span class="s1">&#39;labels_to_indices&#39;</span><span class="p">]</span>
<span class="n">indices_to_labels</span> <span class="o">=</span> <span class="n">_bookkeeping</span><span class="p">[</span><span class="s1">&#39;indices_to_labels&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">_bookkeeping</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;labels_to_indices: label as keys, and list of sample indices as values&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels_to_indices</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;indices_to_labels: index as key, and corresponding label as value&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indices_to_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): labels_to_indices: label as keys, and list of sample indices as values
defaultdict(<class 'list'>, {0: [0, 1, 2, 3, 4, ..., 16, 17, 18, 19], 1: [20, 21, 22, 23, 24, 25, ..., 28, 29], ..., 1622: [32440, 32441, 32442, 32443, 32444, ..., 32458, 32459]})</p>
<p>indices_to_labels: index as key, and corresponding label as value
defaultdict(<class 'int'>, {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6, ..., 32458: 1622, 32459: 1622})</p>
</blockquote>
<p>So far, we understood the motivation for using <code>MetaDataset</code>. In the next sections, we will discuss exactly how the dictionaries generated using <code>MetaDataset</code> are used for creating a task.</p>
<h3 id="unionmetadataset-a-wrapper-for-multiple-datasets">UnionMetaDataset - A wrapper for multiple datasets<a class="headerlink" href="#unionmetadataset-a-wrapper-for-multiple-datasets" title="Permanent link">&para;</a></h3>
<p><code>UnionMetaDataset</code> is an extension of <code>MetaDataset</code>, and it is used to merge multiple datasets into one. This is useful when you want to sample heterogenous tasks - tasks in a metabatch being from different distributions.</p>
<p><code>learn2learn</code> implements it by simply remapping the labels of the dataset in a consecutive order. For example, say you have two datasets: <script type="math/tex">\mathcal{D}_1</script>: {1600 labels, 32000 samples} and <script type="math/tex">\mathcal{D}_2</script>: {400 labels, 12000 samples}. After wrapping the datasets using <code>UnionMetaDataset</code> we will get a MetaDataset that will have 2000 labels and 44000 samples, where the initial 1600 labels (0, 1, 2, ..., 1599) will be from <script type="math/tex">\mathcal{D}_1</script> and (1600, 1601, ..., 1999) labels will be from <script type="math/tex">\mathcal{D}_2</script>. Same is the case for the indices of the union.</p>
<blockquote>
<p>A list of datasets is fed as input the <code>UnionMetaDataset</code></p>
</blockquote>
<p>Below code shows how a high level implementation of the wrapper:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">dataset_omniglot</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FullOmniglot</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;~\data&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset_omniglot</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetaDataset</span><span class="p">(</span><span class="n">dataset_omniglot</span><span class="p">)</span> <span class="c1"># If not wrapped, UnionMetaDataset takes care of it.</span>
<span class="n">dataset_fc100</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FC100</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;~\data&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset_fc100</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetaDataset</span><span class="p">(</span><span class="n">dataset_fc100</span><span class="p">)</span>
<span class="n">dataset_cifarfs</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">CIFARFS</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;~\data&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset_cifarfs</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetaDataset</span><span class="p">(</span><span class="n">dataset_cifarfs</span><span class="p">)</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_omniglot</span><span class="p">,</span> <span class="n">dataset_fc100</span><span class="p">,</span> <span class="n">dataset_cifarfs</span><span class="p">]</span>
<span class="n">union</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">UnionMetaDataset</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span> <span class="c1"># a list of datasets is fed as argument</span>
</code></pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">union</span><span class="o">.</span><span class="n">labels_to_indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_omniglot</span><span class="o">.</span><span class="n">labels_to_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_fc100</span><span class="o">.</span><span class="n">labels_to_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_cifarfs</span><span class="o">.</span><span class="n">labels_to_indices</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Union was successful&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something is wrong!&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): Union was successful</p>
</blockquote>
<p>To retrieve a data sample using index, <code>UnionMetaDataset</code> iterates over all the individual datasets as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># For sake of example, consider item = 1690</span>
<span class="c1"># Union of 2 datasets having [1600, 20] and [600, 10] samples &amp; labels respectively</span>
<span class="c1"># Thus, item is in D2 having index 89 and say has label as 3</span>
<span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">union</span><span class="p">):</span>
    <span class="n">ds_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span> <span class="c1"># [D1, D2] (D1 -&gt; 1600 samples, D2 -&gt; 600 samples)</span>
        <span class="k">if</span> <span class="n">ds_count</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">item</span><span class="p">:</span> <span class="c1"># For D1, condition fails</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">item</span> <span class="o">-</span> <span class="n">ds_count</span><span class="p">])</span> <span class="c1"># searches in the D2&#39;s index space</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">indices_to_labels</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="c1"># changes label from 3 to 22 (20 + 3 - 1)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="n">ds_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="c1"># Now, ds_count = 1600</span>

<span class="n">get_item</span><span class="p">(</span><span class="mi">62000</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">union</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Returns modified label </span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): 1670</p>
</blockquote>
<h3 id="filteredmetadataset-filter-out-unwanted-labels">FilteredMetaDataset - Filter out unwanted labels<a class="headerlink" href="#filteredmetadataset-filter-out-unwanted-labels" title="Permanent link">&para;</a></h3>
<p><code>FilteredMetaDataset</code> is a wrapper that takes in a <code>MetaDataset</code> and filters it to only include a subset of the desired labels.</p>
<p>The labels included are not remapped, and the label value from the original dataset is retained.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">toy_omniglot</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FullOmniglot</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;~\data&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">toy_omniglot</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetaDataset</span><span class="p">(</span><span class="n">toy_omniglot</span><span class="p">)</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">FilteredMetaDataset</span><span class="p">(</span><span class="n">toy_omniglot</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original Labels:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">toy_omniglot</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtered Labels:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<h2 id="taskdataset-core-module">TaskDataset - Core module<a class="headerlink" href="#taskdataset-core-module" title="Permanent link">&para;</a></h2>
<h4 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h4>
<p>This is one of the core module of <code>learn2learn</code> that is used to generate a task from a given input dataset. It takes <code>dataset</code>, and list of <code>task transformations</code> as arguments. The task transformation basically define the kind of tasks that will be generated from the dataset. (For example, <code>KShots</code> transform limits the number of samples per class in a task to <code>K</code> samples per class.) </p>
<blockquote>
<p>If there are no task transforms, then the task consists of all the samples in the entire dataset.</p>
</blockquote>
<p>Another argument that <code>TaskDataset</code> takes as input is <code>num_tasks</code> <em>(an integer value)</em>. The value is set depending on how many tasks the user wants to generate. By default, it is kept as <code>-1</code>, meaning infinite number of tasks will be generated, and a new task is generated on sampling. In the former case, the descriptions of the task will be cached in a dictionary such that if a given task is called again, the description can be loaded instantly rather than generating it once again.</p>
<h4 id="what-is-a-task-description">What is a task description?<a class="headerlink" href="#what-is-a-task-description" title="Permanent link">&para;</a></h4>
<p>A <code>task_description</code> is a list of <code>DataDescription</code> objects with two attributes: <code>index</code>, and <code>transforms</code>. <code>Index</code> corresponds to the index of a sample in the dataset, and <code>transforms</code> is a list of transformations that will be applied to the sample.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Transforms: [NWays, KShots, LoadData, RemapLabels, ConsecutiveLabels, RandomClassRotation]</span>

<span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">),</span> <span class="n">description</span><span class="p">)</span>

<span class="c1"># Initially, there are all samples present in the dataset</span>
<span class="c1"># NWays chooses N classes (5 in our case), and samples all the datapoints belonging to only these N classes -&gt; 100 samples (as each class has 20 samples)</span>
<span class="c1"># Next, KShot chooses K samples (1 samples per class in our case) from each of these N classes -&gt; thus reducing the total samples in the task_description to 5</span>
<span class="c1"># And rest of the task transforms do other specicial transformations on the samples without changing the number of samples present in the description </span>
</code></pre></div>
</td></tr></table>
<h4 id="how-is-a-task-generated_1">How is a task generated?<a class="headerlink" href="#how-is-a-task-generated_1" title="Permanent link">&para;</a></h4>
<p><strong>STEP 1</strong></p>
<p>An index between <code>[0, num_tasks)</code> is randomly generated.\
(If <code>num_tasks = -1</code>, then index is always 0.)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">num_tasks</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_tasks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span>

<span class="n">sample</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><strong>STEP 2</strong></p>
<p>There are two possible methods for generating <code>task_description</code>:</p>
<ol>
<li>
<p>If there's a cached description for the given index, the <code>task_description</code> is assigned the cached description. </p>
</li>
<li>
<p>Otherwise, each transform takes the description returned by the previous transform as argument, and in turn returns a new description. </p>
</li>
</ol>
<blockquote>
<p>The above only holds true when <code>num_tasks != -1</code>, for <code>num_tasks = -1</code>, new description is computed every time.</p>
<p><strong>NOTE -</strong> It is to be noted <code>task_description</code> and <code>data_description</code> are general methods and can be used for any type of task, be it a classification task, regression task, or even a timeseries task.</p>
</blockquote>
<p>Below code discusses both the methods.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Method 1: Cached Description</span>
<span class="c1"># If there&#39;s a cached description for the given index, the `task_description` is assigned the cached description. </span>

<span class="n">sampled_descriptions</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># a dictionary for caching descriptions</span>
<span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sampled_descriptions</span><span class="p">:</span> <span class="c1"># i is the index of task between [0, num_tasks]</span>
    <span class="n">sampled_descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Call Method 2&#39;</span> <span class="c1"># call sample_task_description()</span>
<span class="n">task_description</span> <span class="o">=</span> <span class="n">sampled_descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Method 2: If method 1 fails, or num_tasks = -1</span>
<span class="c1"># 2.Each transform takes the description returned by the previous transform as argument, and in turn returns a new description.</span>

<span class="k">def</span> <span class="nf">sample_task_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#  Samples a new task description.</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># initialize description as None at the start</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_transforms</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_transforms</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_transforms</span><span class="p">:</span> <span class="c1"># iterate on the transfroms list [NWays, Kshots, LoadData, ...]</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="c1"># use the description generated by the  previous transform for the current transform</span>
    <span class="k">return</span> <span class="n">description</span> <span class="c1"># A description modified by all the transforms present in the list.</span>
</code></pre></div>
</td></tr></table>
<p><strong>STEP 3</strong></p>
<p>Once a <code>task_description</code> is retrieved/generated, task is generated by applying the list of transformations present in each of the <code>DataDescription</code> objects in the task description list. </p>
<blockquote>
<p>The transformations mentioned above are different from <code>task_transforms</code> (<code>task_transforms</code> examples: <code>NWays</code>, <code>KShots</code>, <code>LoadData</code>, etc.) </p>
</blockquote>
<p>All the data samples generated in the list are accumulated and collated using <code>task_collate</code>. (by default, <code>task_collate</code> is assigned <code>collate.default_collate</code>)</p>
<p><code>DataDescription</code> object has two attributes:
<code>index</code> of the sample and any <code>transforms</code> that need to be applied on the sample. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_description</span><span class="p">):</span>
    <span class="c1">#  Given a task description, creates the corresponding batch of data.</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data_description</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span> <span class="c1"># iterate over all the samples in task description</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data_description</span><span class="o">.</span><span class="n">index</span> <span class="c1"># loads index of the sample present in the original dataset</span>
        <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">data_description</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="c1"># There are two task_transforms (LoadData and RemapLabels) that apply transforms on the data</span>
            <span class="c1"># as of now in the learn2learn library.  </span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># applies transform sequentially on the sample data</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_collate</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span> <span class="c1"># by default makes use of collate.default_colllate</span>
</code></pre></div>
</td></tr></table>
<p>We will be discussing more about the <code>data_description.transforms</code> in the next section, after which there will be more clarity on exactly how the above snippet modifies the data.</p>
<h4 id="a-few-general-tips">A few general tips<a class="headerlink" href="#a-few-general-tips" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>If you have not wrapped the dataset with <code>MetaDataset</code> or its variants, the function will automatically instantiate <code>MetaDataset</code> wrapper.</p>
</li>
<li>
<p>If you are not sure how many tasks you want to generate, use <code>num_tasks = -1</code>.</p>
</li>
<li>
<p>If <code>num_tasks = N</code>, and you are sampling <code>M</code> tasks where <code>M &gt; N</code>, then <code>M - N</code> tasks will definitely be repeated. In case you want to avoid it, make sure <code>N &gt;= M</code>.</p>
</li>
<li>
<p>Given a list of task transformations, the transformations are applied in the order they are listed. (Task generated using <script type="math/tex">[T_1, T_2]</script> transforms might be different from that generated using <script type="math/tex">[T_2, T_1]</script>.</p>
</li>
<li>
<p>A <code>task</code> is lazily sampled upon indexing, or using <code>.sample()</code>. <code>.sample()</code> is equivalent to indexing, just that before indexing, it randomly generates an index to be indexed.</p>
</li>
<li>
<p>When using <code>KShots</code> transform, query twice the samples required for training. The queried samples will need to be split in half, for training, and evaluation. <code>learn2learn</code> provides a nice utility called <code>partition_task()</code> to partition the data in support and query sets. Check <a href="https://github.com/learnables/learn2learn/blob/master/learn2learn/data/utils.py#L87">this</a> to know more about it. A quick use case:</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># k-shot learning scenario</span>
<span class="p">(</span><span class="n">adapt_data</span><span class="p">,</span> <span class="n">adapt_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">eval_data</span><span class="p">,</span> <span class="n">eval_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">partition_task</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<ol>
<li><code>task_description</code> and <code>data_description</code> are general methods and can be used for any type of task, be it a classification task, regression task, or even a timeseries task.</li>
</ol>
<p>In the next section, we will examine how the <code>task_transforms</code> exactly modify the input dataset to generate a task.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DataDescription</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
</td></tr></table>
<h2 id="task-tranforms-modifying-the-input-dataset">Task Tranforms - Modifying the input dataset<a class="headerlink" href="#task-tranforms-modifying-the-input-dataset" title="Permanent link">&para;</a></h2>
<p>Task transforms are a set of transformations that decide on what kind of a task is generated at the end. We will quickly go over some of the transforms defined in <code>learn2learn</code>, and examine how they are used.</p>
<p>To reiterate, a DataDescripton is a class that has two attributes: index, and transforms. Index stores the index of the data sample, and transforms stores list of transforms if there are any (transforms is different from task transforms). In layman's words, it stores indices of samples in the dataset.</p>
<blockquote>
<p>Only <code>LoadData</code> and <code>RemapLabels</code> add transforms in the list of transform attribute in <code>DataDescription</code> object.</p>
</blockquote>
<h4 id="high-level-interface">High-Level Interface<a class="headerlink" href="#high-level-interface" title="Permanent link">&para;</a></h4>
<p>Each of the task transform classes is inherited from <code>TaskTranform</code> class. All of them have a common skeleton in the form of three methods namely: <code>__init__()</code>, <code>__call__()</code> and <code>new_task()</code>.</p>
<p>We will now discuss what each of these methods do in general.</p>
<p><strong><code>__init__()</code> Method</strong></p>
<p>Initializes the newly created object, in the transform, while also inheriting some arguments such as the dataset from the parent class. Objects / variables that needed to be instantiated only again are defined here.</p>
<p><strong><code>__call__()</code> Method</strong></p>
<p>It's a callable method, and is used as a function to write the <code>task_transform</code> specific functionality. Objects / variables that keep on changing are defined here.</p>
<p><strong><code>new_task()</code> Method</strong></p>
<p>If the <code>task_description</code> is empty (that is, <code>None</code>), then this method is called. This method loads all the samples present in the dataset to the <code>task_description</code>. For instance, check the code below. It loads all the samples present in the dataset to the <code>task_description</code> </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">new_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">task_description</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="c1"># generate an empty matrix</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">task_description</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataDescription</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># Add samples wrapped around DataDescription to the list.</span>
    <span class="k">return</span> <span class="n">task_description</span>
</code></pre></div>
</td></tr></table>
<h4 id="a-fusednwayskshots">A) FusedNWaysKShots<a class="headerlink" href="#a-fusednwayskshots" title="Permanent link">&para;</a></h4>
<p>Efficient implementation of <code>KShots</code>, <code>NWays</code>, and <code>FilterLabels</code> transforms. We will be discussing each of the individual transforms in the subsequent sections. </p>
<p>If you are planning to make use of more than 1 or these transforms, it is recommended to make use of <code>FusedNWaysKshots</code> transform instead of using each of them individually. </p>
<h4 id="b-nways">B) NWays<a class="headerlink" href="#b-nways" title="Permanent link">&para;</a></h4>
<p>Keeps samples from <code>N</code> random labels present in the task description. <code>NWays</code> iterate over the current task description to generate a new description as follows:</p>
<ul>
<li>If no <code>task_description</code> is available, <code>NWays</code> randomly samples <code>N</code> labels, and adds all the samples in these <code>N</code> random labels using <code>labels_to_indices</code> dictionary.</li>
<li>Else, using <code>indices_to_labels</code> dictionary, it first identifies the unique labels present in the description. Next, it randomly samples <code>N</code> labels from the set of classes.</li>
<li>Lastly, it iterates over all the indices present in the description. If the <code>index</code> belongs to the set of these <code>N</code> random labels, the sample is added in the new <code>task_description</code>.</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Step 1 : When no task description is available, sample pool is entire dataset</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># Randomly sample K classes that will be used for generating the task</span>
<span class="n">example</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span> <span class="c1"># add only samples belonging to these classes </span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">labels_to_indices</span><span class="p">[</span><span class="n">cl</span><span class="p">]:</span>
        <span class="c1"># Adds the sample index to the task description wrapped in DataDescription object</span>
        <span class="c1"># task_description.append(DataDescription(idx))</span>
        <span class="c1"># For sake of explaination I am adding the next step</span>
        <span class="n">example</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of samples:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">))</span> <span class="c1"># should be 100 as each class has 20 samples in omniglot</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): [14380, 14381, 14382, ..., 31196, 31197, 31198, 31199]
Number of samples: 100</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Step 2 : If there&#39;s an existing task description, identify unique labels present in the description</span>
<span class="k">def</span> <span class="nf">unique_labels</span><span class="p">():</span>
    <span class="n">set_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># to remove repeated entries</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span>
        <span class="n">set_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">indices_to_labels</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">index</span><span class="p">])</span> <span class="c1"># adds label of each sample index present in the description </span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">set_classes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">classes</span> <span class="c1"># returns unique list of classes</span>

<span class="c1"># Step 3 : Sample indices belonging the list of randomly choosen classes</span>
<span class="k">def</span> <span class="nf">n_samples</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">(),</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">indices_to_labels</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="c1"># adds all the indices belonging to the 5 randomly choosen classes </span>
    <span class="k">return</span> <span class="n">result</span> <span class="c1"># return new task description</span>
</code></pre></div>
</td></tr></table>
<h4 id="c-kshots">C) KShots<a class="headerlink" href="#c-kshots" title="Permanent link">&para;</a></h4>
<p>It samples <code>K</code> samples per label from all the labels present in the <code>task_desription</code>. Similar to <code>NWays</code>, <code>KShots</code> iterate over the samples present in the current <code>task_description</code> to generate a new one:</p>
<ul>
<li>If <code>task_description</code> is <code>None</code>, load all the samples present in the dataset.</li>
<li>Else, generate a <code>class_to_data</code> dictionary that stores label as key and corresponding samples as value.</li>
<li>Lastly, <code>K</code> samples are sampled from each of the classes either with or without replacement.</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Step 1 : Task description is None</span>
<span class="c1"># Load all samples in dataset</span>
<span class="n">task_description</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)):</span>
    <span class="n">task_description</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataDescription</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Step 2 : Create a dictionary that stores labels and their corresponding samples</span>
<span class="n">class_to_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">indices_to_labels</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">class_to_data</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

<span class="c1"># Step 3 : Sample K datapoints from each class with or without replacement</span>
<span class="c1"># if with replacement, use</span>
<span class="k">def</span> <span class="nf">sampler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)]</span>
<span class="c1"># else use</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span>
<span class="c1"># Lastly, sample the datapoints</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">sampler</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">dds</span> <span class="ow">in</span> <span class="n">class_to_data</span><span class="o">.</span><span class="n">values</span><span class="p">()])))</span> <span class="c1"># here, we are sampling 2 datapoints per class.</span>
<span class="c1"># There are 1623 classes having 20 samples per class -&gt; 32460 datapoints</span>
<span class="c1"># Thus, if we sample 2 datapoints per class, that will leave us with 3246 datapoints</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): 3246</p>
</blockquote>
<h4 id="d-loaddata">D) LoadData<a class="headerlink" href="#d-loaddata" title="Permanent link">&para;</a></h4>
<p>Loads a sample from the dataset given its index. Does so by appending a transform <code>lambda x: self.dataset[x]</code> to <code>transforms</code> attribute present in DataDescription for each sample.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Loads the data using transforms which will be used when calling get_task() in task_dataset.pyx</span>
<span class="k">for</span> <span class="n">data_description</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span>
    <span class="n">data_description</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
<hr />
<blockquote>
<p>The above three task transforms are the main transforms that are usually used when generating few-shot learning tasks. These transforms can be used in any other.</p>
</blockquote>
<hr />
<h4 id="e-filterlabels">E) FilterLabels<a class="headerlink" href="#e-filterlabels" title="Permanent link">&para;</a></h4>
<p>It's a simple transform that removes any unwanted labels from the <code>task_description</code>. In addition to the dataset, it takes a list of labels that need to be included as an argument.</p>
<ul>
<li>It first generates filtered indices that keep a track on all the indices of the samples from the input labels.</li>
<li>Next, it iterates over all the indices in the task description, and filters them out if they don't belong to the filtered indices.</li>
</ul>
<blockquote>
<p>If you are using FilterLabels transform, it is recommended to use it before NWays, and KShots transforms.</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Step 1 : Generate filtered indices</span>
<span class="kn">import</span> <span class="nn">array</span>

<span class="n">filtered_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">filtered_indices</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)):</span>
    <span class="c1"># will generate a sparse list with labels for the samples with filtered labels</span>
    <span class="n">filtered_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices_to_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">filtered_labels</span><span class="p">)</span> 

<span class="c1"># Step 2 : Filter out descriptions that don&#39;t belong to the filtered indices</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">filtered_indices</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">index</span><span class="p">]:</span> <span class="c1"># if index value is non-zero</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="c1"># 20 samples for 5 classes each -&gt; 100 samples</span>
</code></pre></div>
</td></tr></table>
<h4 id="f-consecutivelabels">F) ConsecutiveLabels<a class="headerlink" href="#f-consecutivelabels" title="Permanent link">&para;</a></h4>
<p>The transform re-orders the samples present in the <code>task_description</code> according to the label order consecutively. If you are using <code>RemapLabels</code> transform and keeping <code>shuffle=True</code>, it is recommended to keep <code>ConsecutiveLabels</code> tranform after <code>RemapLabels</code>, otherwise, while they will be homogeneously clustered, the ordering would be random. If you are using <code>ConsecutiveLabels</code> transform before <code>RemapLabels</code>, and want ordered set of labels, then keep <code>shuffle=False</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># How consecutive labels transform is implemented</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dd</span><span class="p">,</span> <span class="n">indices_to_labels</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">index</span><span class="p">])</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">task_description</span><span class="p">]</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># sort by labels x[0] : index, x[1] : label</span>
<span class="nb">print</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span>

<span class="c1"># Example demonstration</span>
<span class="n">toy_dataset</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span> <span class="c1"># generate a toy dataset</span>
<span class="n">toy_indices_to_labels</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">toy_dataset</span><span class="p">:</span>
    <span class="n">toy_indices_to_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span> <span class="c1"># generate a toy indices to labels dictionary</span>

<span class="n">toy_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span> <span class="c1"># generate a toy samples list</span>
<span class="n">toy_task_description</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">toy_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span> <span class="c1"># generate a random task description</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dd</span><span class="p">,</span> <span class="n">toy_indices_to_labels</span><span class="p">[</span><span class="n">dd</span><span class="p">])</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">toy_task_description</span><span class="p">]</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># sort the pairs list by using the second element (labels) in the tuple</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span> <span class="c1"># prints index (not ordered)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span> <span class="c1"># prints label (ordered list)</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>(out): [271, 702, 756, 319, 948, 840, 843, 741, 89, 413]
[13, 33, 34, 46, 56, 57, 62, 70, 76, 92]</p>
</blockquote>
<h4 id="g-remaplabels">G) RemapLabels<a class="headerlink" href="#g-remaplabels" title="Permanent link">&para;</a></h4>
<p>The transform maps the labels of input to <code>0, 1, ..., N</code> (given <code>N</code> unique set of labels). </p>
<p><em>For example</em>, if input <code>task_description</code> consists of samples from 3 labels namely 71, 14 and 89, then the transform maps the labels to 0, 1 and 2. Compulsorily needs to be present after <code>LoadData</code> transform in the transform list, otherwise, will give a <code>TypeError: int is not iterable</code>.</p>
<p>The error occurs because <code>RemapLabels</code> expects the input to be of iterable form. Thus, unless you load data using <code>LoadData</code> prior to it, it will try to iterate over sample <code>index</code>, which is an <code>int</code>, and not an iterable.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">traceback</span>

<span class="n">toy_transforms</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">NWays</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="c1"># Samples N random classes per task (here, N=5)</span>
                <span class="n">KShots</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="c1"># Samples K samples per class from the above N classes (here, K=1) </span>
                <span class="n">RemapLabels</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span>
                <span class="n">LoadData</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span> <span class="c1"># Loads a sample from the dataset</span>
                <span class="n">ConsecutiveLabels</span><span class="p">(</span><span class="n">omniglot</span><span class="p">),</span> <span class="c1"># Re-orders samples s.t. they are sorted in consecutive order </span>
                <span class="n">RandomClassRotation</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">])</span> <span class="c1"># Randomly rotate sample over x degrees (only for vision tasks)</span>
                <span class="p">]</span>
<span class="n">toy_taskset</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TaskDataset</span><span class="p">(</span><span class="n">omniglot</span><span class="p">,</span> <span class="n">toy_transforms</span><span class="p">,</span> <span class="n">num_tasks</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">toy_taskset</span><span class="o">.</span><span class="n">sample</span><span class="p">()))</span> <span class="c1"># Expected error as RemapLabels is used before LoadData</span>
<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
</code></pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="o">(</span>output<span class="o">)</span>:
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;&lt;ipython-input-27-4c0558e6745b&gt;&quot;</span>, line <span class="m">13</span>, <span class="k">in</span> &lt;module&gt;
    print<span class="o">(</span>len<span class="o">(</span>toy_taskset.sample<span class="o">()))</span> <span class="c1"># Expected error as RemapLabels is used before LoadData</span>
  File <span class="s2">&quot;learn2learn/data/task_dataset.pyx&quot;</span>, line <span class="m">158</span>, <span class="k">in</span> learn2learn.data.task_dataset.CythonTaskDataset.sample
  File <span class="s2">&quot;learn2learn/data/task_dataset.pyx&quot;</span>, line <span class="m">173</span>, <span class="k">in</span> learn2learn.data.task_dataset.CythonTaskDataset.__getitem__
  File <span class="s2">&quot;learn2learn/data/task_dataset.pyx&quot;</span>, line <span class="m">142</span>, <span class="k">in</span> learn2learn.data.task_dataset.CythonTaskDataset.get_task
  File <span class="s2">&quot;learn2learn/data/transforms.pyx&quot;</span>, line <span class="m">201</span>, <span class="k">in</span> learn2learn.data.transforms.RemapLabels.remap
TypeError: <span class="s1">&#39;int&#39;</span> object is not iterable
</code></pre></div>
</td></tr></table>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Thus, we studied how <code>learn2learn</code> simplifies the process of generating few-shot learning tasks. For more details, have a look at:</p>
<ol>
<li><a href="http://learn2learn.net/docs/learn2learn.data/">Official Documentation</a></li>
<li><a href="https://github.com/learnables/learn2learn/tree/master/learn2learn/data">Module Scripts - GitHub</a></li>
</ol>
<p><code>learn2learn</code> provides benchmarks for some of the commonly used computer vision datasets such as <code>omniglot</code>, <code>fc100</code>, <code>mini-imagenet</code>, <code>cirfarfs</code> and <code>tiered-imagenet</code>. The benchmarks are available at <a href="https://github.com/learnables/learn2learn/tree/master/learn2learn/vision/benchmarks">this</a> link. </p>
<p>They are  very easy to use, and can be used as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># data_name: &#39;omniglot&#39;, &#39;fc100&#39;, &#39;cifarfs&#39;, &#39;mini-imagenet&#39;, &#39;tiered-imagenet&#39;</span>
<span class="c1"># N: No of ways, K: No of shots</span>
<span class="n">tasksets</span> <span class="o">=</span> <span class="n">l2l</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">benchmarks</span><span class="o">.</span><span class="n">get_tasksets</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span> <span class="n">train_ways</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">train_samples</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">K</span><span class="p">,</span> <span class="n">test_ways</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">K</span><span class="p">,</span> <span class="n">num_tasks</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s1">&#39;~/data&#39;</span><span class="p">)</span>
<span class="n">X1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">tasksets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">X2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">tasksets</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">X3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">tasksets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>If you have any other queries - feel free to ask questions on the library's <a href="http://slack.learn2learn.net/">slack</a> channel, or open an issue <a href="https://github.com/learnables/learn2learn/issues">here</a>.</p>
<p>Thank you! </p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../anil_tutorial/ANIL_tutorial/" title="Feature Reuse with ANIL" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Feature Reuse with ANIL
              </span>
            </div>
          </a>
        
        
          <a href="../../../docs/learn2learn/" title="learn2learn" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                learn2learn
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/learnables" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/seba1511" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/learnables/learn2learn/issues/new" target="_blank" rel="noopener" title="bug" class="md-footer-social__link fa fa-bug"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.2.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/mathtex-script-type.min.js"></script>
      
    
  </body>
</html>